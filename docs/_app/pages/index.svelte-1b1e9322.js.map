{"version":3,"file":"index.svelte-1b1e9322.js","sources":["../../../../../src/lib/matrix.js","../../../../../src/lib/velocity.js","../../../../../src/lib/other.js","../../../../../src/lib/panzoom.js","../../../../../src/lib/_components/Spot.svelte","../../../../../src/routes/index.svelte"],"sourcesContent":["export default class Matrix {\r\n\tconstructor({ container }) {\r\n\t\tthis.container = container;\r\n\t\tthis.vtm = this.createMatrix();\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\r\n\t\tthis.captureScale = 1;\r\n\t\tthis.stop = false;\r\n\t}\r\n\r\n\tclamp(scale, in_x, in_y, ratio) {\r\n\t\tlet xx = (this.container.clientWidth - ratio.width) / 2;\r\n\t\tlet yy = (this.container.clientHeight - ratio.height) / 2;\r\n\r\n\t\tlet limit_max_right_formula = xx * scale + ratio.width * scale - this.container.clientWidth;\r\n\r\n\t\tlet same_x = Math.min(this.vtm.e * 1.0, 0);\r\n\t\tlet same_y = Math.min(this.vtm.f * 1.0, 0);\r\n\r\n\t\tlet value1 = in_x > 0 ? same_x : -(xx * scale);\r\n\t\tlet value2 = in_x > 0 ? same_x : -limit_max_right_formula;\r\n\r\n\t\tlet limit_x_axis = this.vtm.e;\r\n\t\tlimit_x_axis = Math.max(value2, this.vtm.e);\r\n\t\tlimit_x_axis = Math.min(value1, limit_x_axis);\r\n\r\n\t\tlet limit_max_bottom_formula = yy * scale + ratio.height * scale - this.container.clientHeight;\r\n\t\tlet limit_max_top = in_y > 0 ? same_y : -(yy * scale);\r\n\t\tlet limit_max_bottom = in_y > 0 ? same_y : -limit_max_bottom_formula;\r\n\r\n\t\tlet limit_y_axis = this.vtm.f;\r\n\t\tlimit_y_axis = Math.min(limit_max_top, limit_y_axis);\r\n\t\tlimit_y_axis = Math.max(limit_y_axis, limit_max_bottom);\r\n\r\n\t\tthis.vtm = this.createMatrix()\r\n\t\t\t.translate(limit_x_axis, limit_y_axis)\r\n\t\t\t.scale(Math.max(this.vtm.a, 1));\r\n\t}\r\n\r\n\tcreateMatrix() {\r\n\t\t/**\r\n\t\t * https://developer.mozilla.org/en-US/docs/Web/API/DOMMatrix/DOMMatrix \r\n\t\t * \r\n\t\t * 6-element array of components in the form [a, b, c, d, e, f]\r\n\t\t * which represent 2x3 matrices of the form:\r\n\t\t * \r\n\t\t * [a c e] ( a [x,y,t] Vector )\r\n\t\t * [b d f] ( another [x,y,t] Vector )\r\n\t\t * \r\n\t\t * [\r\n\t\t\tMath.sin(angle) * scaleX,\r\n\t\t\tMath.cos(angle) * scaleX,\r\n\t\t\t-Math.sin(angle) * scaleY,\r\n\t\t\tMath.cos(angle) * scaleY,\r\n\t\t\ttranslateX,\r\n\t\t\ttranslateY\r\n\t\t\t]\r\n\t\t * \r\n\t\t *\tDeprecated: https://developer.mozilla.org/en-US/docs/Web/API/SVGMatrix \r\n\t\t */\r\n\t\treturn new DOMMatrix();\r\n\t}\r\n\r\n\tmove(x, y, in_x, in_y, ratio) {\r\n\t\tthis.vtm = this.createMatrix()\r\n\t\t\t.translate(this.x - x, this.y - y)\r\n\t\t\t.scale(this.vtm.a);\r\n\r\n\t\t// this.clamp(this.vtm.a, in_x, in_y, ratio);\r\n\t\treturn this.vtm;\r\n\t}\r\n\r\n\t/**\r\n\t * Scale the vtm.\r\n\t * @param {Number} xFactor - The amount to scale in the x direction.\r\n\t * @param {Number} yFactor - The amount to scale in the y direction.\r\n\t * @param {Point} origin - The origin point at which the scale should be centered.\r\n\t */\r\n\tscale(xFactor, yFactor, origin, in_x, in_y, ratio, max, value, dir) {\r\n\t\t// dir == 1,zooming in\r\n\t\t// if ((value >= max || this.stop) && dir === 1) {\r\n\t\t// \tthis.stop = true;\r\n\t\t// \tif (!this.deb) {\r\n\t\t// \t\tthis.captureScale = this.vtm.a;\r\n\t\t// \t\tthis.vtm = this.createMatrix()\r\n\t\t// \t\t\t.translate(origin.x, -origin.y)\r\n\t\t// \t\t\t.scale(max / this.captureScale)\r\n\t\t// \t\t\t.translate(-origin.x, origin.y)\r\n\t\t// \t\t\t.translate(this.vtm.e, this.vtm.f)\r\n\t\t// \t\t\t.scale(this.captureScale);\r\n\r\n\t\t// \t\tthis.deb = true;\r\n\t\t// \t}\r\n\t\t// \treturn this.vtm;\r\n\t\t// } else {\r\n\t\t// \tthis.stop = false;\r\n\t\t// }\r\n\r\n\t\tthis.vtm = this.createMatrix()\r\n\t\t\t.translate(origin.x, origin.y)\r\n\t\t\t.scale(xFactor, yFactor)\r\n\t\t\t.translate(-origin.x, -origin.y)\r\n\t\t\t.multiply(this.vtm);\r\n\r\n\t\tlet pre_scale = Math.min(Math.max(1, this.vtm.a), max);\r\n\r\n\t\t// V V V V doesn't allow us to zoom into corners.. :/\r\n\t\t// this.clamp(pre_scale, in_x, in_y, ratio);\r\n\r\n\t\treturn this.vtm;\r\n\t}\r\n}\r\n","export default class MultiTouchVelocity {\r\n\tconstructor() {\r\n\t\tthis.touchA = {\r\n\t\t\tclientX: 0,\r\n\t\t\tclientY: 0,\r\n\t\t\tt: 0,\r\n\t\t\tvelocity: 1\r\n\t\t};\r\n\t\tthis.touchB = {\r\n\t\t\tclientX: 0,\r\n\t\t\tclientY: 0,\r\n\t\t\tt: 0,\r\n\t\t\tvelocity: 1\r\n\t\t};\r\n\t}\r\n\r\n\tdown(touchA, touchB) {\r\n\t\tthis.touchA = { clientX: touchA.clientX, clientY: touchA.clientY, t: Date.now(), velocity: 0 };\r\n\t\tthis.touchB = { clientX: touchB.clientX, clientY: touchB.clientY, t: Date.now(), veloctiy: 0 };\r\n\t}\r\n\r\n\tcalc(touch, ins) {\r\n\t\tvar new_x = touch.clientX,\r\n\t\t\tnew_y = touch.clientY,\r\n\t\t\tnew_t = Date.now();\r\n\r\n\t\tvar x_dist = new_x - ins.clientX,\r\n\t\t\ty_dist = new_y - ins.clientY,\r\n\t\t\tinterval = new_t - ins.t;\r\n\t\tvar velocity = Math.sqrt(x_dist * x_dist + y_dist * y_dist) / interval;\r\n\t\tins.velocity = velocity;\r\n\t\t// update values:\r\n\t\tins.clientX = new_x;\r\n\t\tins.clientY = new_y;\r\n\t\tins.t = new_t;\r\n\t}\r\n\r\n\tgetVelocity(touchA, touchB) {\r\n\t\tthis.calc(touchA, this.touchA);\r\n\t\tthis.calc(touchB, this.touchB);\r\n\t\treturn this.touchA.velocity + this.touchB.velocity;\r\n\t}\r\n}\r\n","function calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {\r\n\tvar ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\r\n\r\n\treturn { width: srcWidth * ratio, height: srcHeight * ratio, ratio };\r\n}\r\n\r\nfunction getDistance(touchA, touchB) {\r\n\treturn Math.hypot(touchA.pageX - touchB.pageX, touchA.pageY - touchB.pageY);\r\n}\r\n\r\nexport { calculateAspectRatioFit, getDistance };\r\n","import Matrix from './matrix';\r\nimport MultiTouchVelocity from './velocity';\r\nimport { calculateAspectRatioFit, getDistance } from './other';\r\n\r\nlet smooth = true;\r\nlet touchScreen = false;\r\nlet xY = {\r\n\tinitX: 0,\r\n\tinitY: 0,\r\n\tnewX: 0,\r\n\tnewY: 0\r\n};\r\nlet ratio;\r\nlet matrix;\r\nlet willChange = true;\r\nlet velocity = new MultiTouchVelocity();\r\nlet lastTap = {\r\n\ttime: 0,\r\n\tx: 0,\r\n\ty: 0\r\n};\r\n\r\nexport const zoomIn = () => fireManualZoom(1);\r\nexport const zoomOut = () => fireManualZoom(-1);\r\n\r\n// Svelte action directive\r\n// see https://svelte.dev/docs#template-syntax-element-directives-use-action\r\nexport const panzoom = (node, params = {}) => {\r\n\tlet scale = {\r\n\t\tscaling: false,\r\n\t\tx1: 0,\r\n\t\tx2: 0,\r\n\t\ty1: 0,\r\n\t\ty2: 0,\r\n\t\tlastHypo: 0,\r\n\t\toriginX: 0,\r\n\t\toriginY: 0,\r\n\t\tvalue: params?.scale?.value || 1,\r\n\t\tmax: 20\r\n\t};\r\n\r\n\tlet container = node.parentElement || document.body;\r\n\r\n\t// ensure touch and select action defaults are disable\r\n\tcontainer.style['touch-action'] = 'none';\r\n\tcontainer.style['user-select'] = 'none';\r\n\tcontainer.style['overflow'] = 'hidden';\r\n\tcontainer.style['position'] = 'relative';\r\n\r\n\tnode.style['touch-action'] = 'none';\r\n\tnode.style['user-select'] = 'none';\r\n\tnode.style['position'] = 'absolute';\r\n\tnode.style['height'] = '100%';\r\n\tnode.style['width'] = '100%';\r\n\r\n\tmatrix = new Matrix({ container });\r\n\r\n\tonLoad();\r\n\r\n\t// container listeners\r\n\tnode.addEventListener('dragstart', onDragStart, { passive: false });\r\n\tnode.addEventListener('drag', onDragStart, { passive: false });\r\n\tcontainer.addEventListener('mousedown', onMouseDown, { passive: false });\r\n\tcontainer.addEventListener('touchstart', onTouchStart, { passive: false });\r\n\tcontainer.addEventListener('wheel', onWheel, { passive: false });\r\n\tcontainer.addEventListener('dragstart', onDragStart, { passive: false });\r\n\tcontainer.addEventListener('drag', onDragStart, { passive: false });\r\n\r\n\t// window listeners\r\n\twindow.addEventListener('resize', onResize);\r\n\r\n\t/**\r\n\t * Also set up a mutation observer so that the node.style.transform can be adjusted outside this\r\n\t * directive, and the directive will update accordingly\r\n\t */\r\n\t// Create an observer instance linked to the callback function\r\n\tconst observer = new MutationObserver((mutationsList, observer) => {\r\n\t\t// Use traditional 'for loops' for IE 11\r\n\r\n\t\tfor (const mutation of mutationsList) {\r\n\t\t\tif (mutation.type === 'attributes') {\r\n\t\t\t\tlet m;\r\n\t\t\t\tconst re = /(\\w+)\\(([^)]*)\\)/g;\r\n\t\t\t\twhile ((m = re.exec(node.style['transform']))) {\r\n\t\t\t\t\tif (m[1] == 'scale' && parseFloat(m[2]).toFixed(2) != scale.value.toFixed(2)) {\r\n\t\t\t\t\t\tscale.value = m[2];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Start observing the target node for configured mutations\r\n\tobserver.observe(node, { attributes: true, childList: false, subtree: false });\r\n\r\n\tfunction onDragStart(e) {\r\n\t\tconsole.log('Removing drag listener');\r\n\t\t//cancel the natural drag listener\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction onLoad() {\r\n\t\tconst { offsetWidth, offsetHeight } = node;\r\n\r\n\t\tratio = calculateAspectRatioFit(\r\n\t\t\toffsetWidth,\r\n\t\t\toffsetHeight,\r\n\t\t\tcontainer.clientWidth,\r\n\t\t\tcontainer.clientHeight\r\n\t\t);\r\n\t}\r\n\r\n\tfunction onResize() {\r\n\t\tonLoad();\r\n\t\tfireDown(0, 0);\r\n\t\tfireMove(0, 0);\r\n\t\tfireUp();\r\n\t}\r\n\r\n\tfunction fireDown(x, y) {\r\n\t\txY.initX = x;\r\n\t\txY.initY = y;\r\n\t\tmatrix.x = matrix.vtm.e;\r\n\t\tmatrix.y = matrix.vtm.f;\r\n\r\n\t\twillChange = true;\r\n\t}\r\n\r\n\tfunction fireMove(x, y) {\r\n\t\tif (scale.scaling) return;\r\n\t\tlet in_x = (container.clientWidth - ratio.width * matrix.vtm.a) / 2;\r\n\t\tlet in_y = (container.clientHeight - ratio.height * matrix.vtm.a) / 2;\r\n\t\txY.newX = xY.initX - x;\r\n\t\txY.newY = xY.initY - y;\r\n\t\tconst mat = matrix.move(xY.newX, xY.newY, in_x, in_y, ratio); // rm clamp\r\n\r\n\t\tnode.style.transform = `matrix(${mat.a},${mat.b},${mat.c},${mat.d},${mat.e}, ${mat.f})`;\r\n\t}\r\n\r\n\tfunction fireUp() {\r\n\t\tmatrix.x -= xY.newX;\r\n\t\tmatrix.y -= xY.newY;\r\n\t\tscale.scaling = false;\r\n\t\tscale.lastHypo = 0;\r\n\t\tsmooth = true;\r\n\t\twillChange = false;\r\n\t}\r\n\r\n\tfunction fireScale(touchA, touchB) {\r\n\t\tconst xTouch = [Math.min(touchA.pageX, touchB.pageX), Math.max(touchA.pageX, touchB.pageX)];\r\n\t\tconst yTouch = [Math.min(touchA.pageY, touchB.pageY), Math.max(touchA.pageY, touchB.pageY)];\r\n\t\tconst W = xTouch[1] - xTouch[0];\r\n\t\tconst centerX = W / 2 + xTouch[0];\r\n\t\tconst H = yTouch[1] - yTouch[0];\r\n\t\tconst centerY = H / 2 + yTouch[0];\r\n\t\tscale.originX = centerX;\r\n\t\tscale.originY = centerY;\r\n\t\tscale.lastHypo = Math.trunc(getDistance(touchA, touchB));\r\n\t\tsmooth = false;\r\n\t}\r\n\r\n\tfunction fireTapScale(x, y) {\r\n\t\tlet scaleVtm = matrix.vtm.a;\r\n\t\tlet scale_value = scaleVtm > 1 ? scaleVtm - 1 : scale.max / 2.5;\r\n\t\tlet scale_factor = scaleVtm > 1 ? -1 : 1;\r\n\t\tconst xFactor = 1 + scale_value * scale_factor;\r\n\t\tconst yFactor = xFactor; // (xFactor * container.clientHeight) / container.clientWidth;\r\n\t\tlet in_x = (container.clientWidth - ratio.width * Math.max(xFactor * scaleVtm, 1)) / 2;\r\n\t\tlet in_y = (container.clientHeight - ratio.height * Math.max(xFactor * scaleVtm, 1)) / 2;\r\n\r\n\t\tconst origin = {\r\n\t\t\tx: x - container.clientWidth / 2 - container.offsetLeft,\r\n\t\t\ty: y - container.clientHeight / 2 - container.offsetTop\r\n\t\t};\r\n\r\n\t\tconst mat = matrix.scale(\r\n\t\t\txFactor,\r\n\t\t\tyFactor,\r\n\t\t\torigin,\r\n\t\t\tin_x,\r\n\t\t\tin_y,\r\n\t\t\tratio,\r\n\t\t\tscale.max,\r\n\t\t\tscale.value * xFactor,\r\n\t\t\tscale_factor\r\n\t\t);\r\n\t\tscale.value = mat.d;\r\n\t\tnode.style.transform = `translate(${mat.e}px, ${mat.f}px) scale(${mat.a})`;\r\n\r\n\t\tnode.dispatchEvent(\r\n\t\t\tnew CustomEvent('zoomed', {\r\n\t\t\t\tdetail: { scale, matrix, origin }\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction fireScaleMove(touchA, touchB, e) {\r\n\t\tconst hypo = getDistance(touchA, touchB);\r\n\t\tlet f = hypo / scale.lastHypo;\r\n\t\tf = f >= 1 ? 1 : -1;\r\n\t\tconst ff = velocity.getVelocity(touchA, touchB) || 1;\r\n\t\tconst xFactor = 1 + 0.1 * ff * f;\r\n\t\tconst yFactor = xFactor; // (xFactor * container.clientHeight) / container.clientWidth;\r\n\t\tlet in_x = (container.clientWidth - ratio.width * matrix.vtm.a) / 2;\r\n\t\tlet in_y = (container.clientHeight - ratio.height * matrix.vtm.a) / 2;\r\n\r\n\t\tconst origin = {\r\n\t\t\tx: scale.originX - container.clientWidth / 2 - container.offsetLeft,\r\n\t\t\ty: scale.originY - container.clientHeight / 2 - container.offsetTop\r\n\t\t};\r\n\r\n\t\tconst mat = matrix.scale(\r\n\t\t\txFactor,\r\n\t\t\tyFactor,\r\n\t\t\torigin,\r\n\t\t\tin_x,\r\n\t\t\tin_y,\r\n\t\t\tratio,\r\n\t\t\tscale.max,\r\n\t\t\tscale.value * xFactor,\r\n\t\t\tf\r\n\t\t);\r\n\r\n\t\tscale.value = mat.d;\r\n\t\tscale.lastHypo = hypo;\r\n\t\tscale.scaling = true;\r\n\t\tnode.style.transform = `translate(${mat.e}px, ${mat.f}px) scale(${mat.a})`;\r\n\t\tnode.dispatchEvent(\r\n\t\t\tnew CustomEvent('zoomed', {\r\n\t\t\t\tdetail: { style: node.style, scale, matrix, origin }\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction fireManualZoom(dir) {\r\n\t\tconst xFactor = 1 + 0.2 * dir;\r\n\t\tconst yFactor = xFactor; // (xFactor * container.clientHeight) / container.clientWidth;\r\n\t\tlet in_x = (container.clientWidth - ratio.width * matrix.vtm.a) / 2;\r\n\t\tlet in_y = (container.clientHeight - ratio.height * matrix.vtm.a) / 2;\r\n\t\tconst origin = {\r\n\t\t\tx: container.clientWidth / 2,\r\n\t\t\ty: container.clientHeight / 2\r\n\t\t};\r\n\r\n\t\tconst mat = matrix.scale(\r\n\t\t\txFactor,\r\n\t\t\tyFactor,\r\n\t\t\torigin,\r\n\t\t\tin_x,\r\n\t\t\tin_y,\r\n\t\t\tratio,\r\n\t\t\tscale.max,\r\n\t\t\tscale.value * xFactor,\r\n\t\t\tdir\r\n\t\t);\r\n\t\tscale.value = mat.d;\r\n\t\tnode.style.transform = `translate(${mat.e}px,${mat.f}px) scale(${mat.a})`;\r\n\r\n\t\tnode.dispatchEvent(\r\n\t\t\tnew CustomEvent('zoomed', {\r\n\t\t\t\tdetail: { style: node.style, scale, matrix, origin }\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction onWheel(e) {\r\n\t\te.preventDefault();\r\n\t\tconst dir = e.deltaY < 0 ? 1 : -1;\r\n\r\n\t\tconst xFactor = 1 + 0.1 * dir;\r\n\t\tconst yFactor = xFactor; // (xFactor * node.clientHeight) / node.clientWidth;\r\n\r\n\t\tlet in_x = (container.clientWidth - ratio.width * matrix.vtm.a) / 2;\r\n\t\tlet in_y = (container.clientHeight - ratio.height * matrix.vtm.a) / 2;\r\n\r\n\t\t// The mouse coordinates.\r\n\t\t// the translate-origin is the middle of the container, so we need to alk back from (center, center)\r\n\t\t// plus any position relative/absolute offset it may have\r\n\r\n\t\tconst origin = {\r\n\t\t\tx: e.pageX - container.clientWidth / 2 - container.offsetLeft,\r\n\t\t\ty: e.pageY - container.clientHeight / 2 - container.offsetTop\r\n\t\t};\r\n\r\n\t\tconst mat = matrix.scale(\r\n\t\t\txFactor,\r\n\t\t\tyFactor,\r\n\t\t\torigin,\r\n\t\t\tin_x,\r\n\t\t\tin_y,\r\n\t\t\tratio,\r\n\t\t\tscale.max,\r\n\t\t\tscale.value * xFactor,\r\n\t\t\tdir\r\n\t\t);\r\n\r\n\t\tscale.value = mat.d;\r\n\r\n\t\tnode.style.transform = `translate(${mat.e}px,${mat.f}px) scale(${mat.a})`;\r\n\r\n\t\tnode.dispatchEvent(\r\n\t\t\tnew CustomEvent('zoomed', {\r\n\t\t\t\tdetail: { style: node.style, scale, matrix, origin }\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tfunction onTouchStart(e) {\r\n\t\ttouchScreen = true;\r\n\t\twillChange = true;\r\n\t\tconst isMultiTouch = e.touches.length === 2;\r\n\t\tconst [touchA, touchB] = e.touches;\r\n\t\tscale.scaling = isMultiTouch;\r\n\t\tsmooth = false;\r\n\t\tif (isMultiTouch) {\r\n\t\t\tfireScale(touchA, touchB);\r\n\t\t\tvelocity.down(touchA, touchB);\r\n\t\t} else {\r\n\t\t\tconst { pageX, pageY } = touchA;\r\n\t\t\tvar now = new Date().getTime();\r\n\t\t\tif (now - lastTap.time < 250 && Math.hypot(lastTap.x - pageX, lastTap.y - pageY) <= 20) {\r\n\t\t\t\tsmooth = true;\r\n\t\t\t\tfireTapScale(pageX, pageY);\r\n\t\t\t} else {\r\n\t\t\t\tfireDown(pageX, pageY);\r\n\t\t\t}\r\n\t\t\tlastTap = {\r\n\t\t\t\ttime: now,\r\n\t\t\t\tx: pageX,\r\n\t\t\t\ty: pageY\r\n\t\t\t};\r\n\t\t}\r\n\t\tnode.removeEventListener('touchmove', onTouchMove);\r\n\t\tnode.removeEventListener('touchend', onTouchEnd);\r\n\t\tnode.addEventListener('touchmove', onTouchMove);\r\n\t\tnode.addEventListener('touchend', onTouchEnd);\r\n\t}\r\n\r\n\tfunction onTouchMove(e) {\r\n\t\tif (scale.scaling) {\r\n\t\t\tconst [touchA, touchB] = e.touches;\r\n\t\t\tfireScaleMove(touchA, touchB);\r\n\t\t} else {\r\n\t\t\tfireMove(e.touches[0].pageX, e.touches[0].pageY);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onTouchEnd(e) {\r\n\t\tfireUp();\r\n\t\tnode.removeEventListener('touchmove', onTouchMove);\r\n\t\tnode.removeEventListener('touchend', onTouchEnd);\r\n\t\tnode.removeEventListener('touchcancel', onTouchEnd);\r\n\t}\r\n\r\n\tfunction onMouseDown(e) {\r\n\t\tif (\r\n\t\t\tcontainer !== e.target &&\r\n\t\t\tnode !== e.target\r\n\t\t\t// node !== e.target.parentNode &&\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst { clientX, clientY } = e;\r\n\t\tif (touchScreen) return;\r\n\t\tfireDown(clientX, clientY);\r\n\t\tsmooth = false;\r\n\t\tcontainer.addEventListener('mousemove', onMouseMove);\r\n\t\tcontainer.addEventListener('mouseup', onMouseUp);\r\n\t}\r\n\r\n\tfunction onMouseMove({ clientX, clientY }) {\r\n\t\tfireMove(clientX, clientY);\r\n\t}\r\n\r\n\tfunction onMouseUp() {\r\n\t\tcontainer.removeEventListener('mousemove', onMouseMove);\r\n\t\tfireUp();\r\n\t}\r\n\r\n\treturn {\r\n\t\tupdate(params) {\r\n\t\t\t// 1 = in, -1 = out\r\n\t\t\tconsole.log('Directive updated params', { params });\r\n\t\t},\r\n\t\tdestroy() {\r\n\t\t\t// container listeners\r\n\t\t\tnode.removeEventListener('wheel', onWheel);\r\n\t\t\tnode.removeEventListener('mousedown', onMouseDown);\r\n\t\t\tnode.removeEventListener('touchstart', onTouchStart);\r\n\t\t\tnode.removeEventListener('dragstart', onDragStart);\r\n\t\t\tnode.addEventListener('drag', onDragStart);\r\n\r\n\t\t\t// window listeners\r\n\t\t\twindow.removeEventListener('resize', onResize);\r\n\r\n\t\t\t// stop observing\r\n\t\t\tobserver.disconnect();\r\n\t\t}\r\n\t};\r\n};\r\n","<script>\r\n\tlet range = 9;\r\n\texport let left = ((1 << range) * Math.random()) | 10;\r\n\texport let top = ((1 << range) * Math.random()) | 10;\r\n\r\n\tlet color = '#' + (((1 << 24) * Math.random()) | 4095).toString(16);\r\n</script>\r\n\r\n<div style=\"top: {top}px; left: {left}px; --color: {color};\">\r\n\t<!-- {left},{top} -->\r\n</div>\r\n\r\n<style>\r\n\tdiv {\r\n\t\t--size: 20px;\r\n\t\tposition: absolute;\r\n\t\tbackground-color: var(--color);\r\n\t\tborder: 1px solid #00000049;\r\n\t\twidth: var(--size);\r\n\t\theight: var(--size);\r\n\t}\r\n</style>\r\n","<script>\n\timport { panzoom } from '$lib/panzoom.js';\n\timport Spot from '$lib/_components/Spot.svelte';\n\timport RangeSlider from 'svelte-range-slider-pips';\n\n\tlet zoomable, container;\n\tlet style = ''; // show styling applied\n\tlet scale = { value: 1 };\n\tlet count = 10;\n\tlet min = count;\n\tlet manualZoom = [1];\n\t// $: if (scale?.value) manualZoom = [scale.value]; // match the directive scale level\n\t$: if (manualZoom) {\n\t\tconsole.log({ manualZoom });\n\t\tsetZoom(manualZoom);\n\t}\n\n\tfunction handleZoom(e) {\n\t\tconsole.log('Zoomed.', { detail: e.detail });\n\t\tscale = e.detail.scale;\n\t\tstyle = zoomable.style.transform;\n\t}\n\n\tconst grid = Array.from({ length: count }, (_, i) =>\n\t\tArray.from({ length: count }, (_, j) => ({ id: i * count + j }))\n\t);\n\n\t// manual zoom\n\tfunction setZoom(val) {\n\t\tconsole.log('Zoom to ', val, zoomable?.style['transform']);\n\t\tif (!zoomable) return;\n\t\tif (!zoomable?.style) {\n\t\t\tconsole.log('Setting Zoom to scale only');\n\t\t\tzoomable.style['transform'] = `scale(${val})`;\n\t\t\treturn;\n\t\t}\n\t\tlet m;\n\t\tlet s = '';\n\n\t\tconst re = /(\\w+)\\(([^)]*)\\)/g;\n\t\twhile ((m = re.exec(zoomable?.style['transform']))) {\n\t\t\tconsole.log({ m });\n\n\t\t\tif (m[1] == 'matrix') {\n\t\t\t\tlet piece = m[2].split(', ');\n\t\t\t\tconsole.log({ piece });\n\t\t\t\ts = `translate(${piece[4]}px, ${piece[5]}px) scale(${val})`;\n\t\t\t\tconsole.log('matrixed', { s });\n\t\t\t\tzoomable.style['transform'] = s;\n\t\t\t\treturn;\n\t\t\t} else if (m[1] == 'scale') {\n\t\t\t\ts += ` scale(${val})`;\n\t\t\t} else {\n\t\t\t\ts += m[0];\n\t\t\t}\n\t\t}\n\t\tconsole.log({ s });\n\t\tzoomable.style['transform'] = s;\n\t}\n</script>\n\n<div>\n\t<h1>Pan and Zoom</h1>\n\t<p>Try out the mouse wheel scroll in the red box below</p>\n\n\t<h2>Inside</h2>\n\t<p>Inside the red box should pan and zoom</p>\n</div>\n\n<div class=\"container\" bind:this={container}>\n\t<div class=\"menu\">\n\t\t<div>\n\t\t\tZoom Level: {scale.value.toFixed(5)} || {JSON.stringify(manualZoom)}\n\t\t\t{#if manualZoom}\n\t\t\t\t<div>\n\t\t\t\t\t<RangeSlider\n\t\t\t\t\t\tpips\n\t\t\t\t\t\tmin={0.5}\n\t\t\t\t\t\tstep={0.5}\n\t\t\t\t\t\tmax={scale?.max || 20}\n\t\t\t\t\t\tfloat\n\t\t\t\t\t\tbind:values={manualZoom}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div>Style: {style}</div>\n\t</div>\n\t<div class=\"zoomable flexbox\" bind:this={zoomable} use:panzoom={{ scale }} on:zoomed={handleZoom}>\n\t\t{#if container}\n\t\t\t<div class=\"grid\">\n\t\t\t\t{#each grid as col, x}\n\t\t\t\t\t<div class=\"col\">\n\t\t\t\t\t\t{#each col as square, y}\n\t\t\t\t\t\t\t<Spot\n\t\t\t\t\t\t\t\tleft={min + (x * container.offsetWidth) / count}\n\t\t\t\t\t\t\t\ttop={min + (y * container.offsetWidth) / count}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.container {\n\t\tborder: 3px solid red;\n\t\theight: 600px;\n\t\twidth: 600px;\n\t\tmargin: 3em;\n\t\t/* overflow: hidden;  its set by the directive :) */\n\t\t/* touch-action: none;  its set by the directive :) */\n\t\t/* position: relative; its set by the directive :) */\n\t}\n\t.zoomable {\n\t\tborder: 4px dashed blue;\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\t/* margin: 1em; */\n\t\t/* position: relative; its set by the directive :) */\n\t}\n\t.flexbox {\n\t\tdisplay: flex;\n\t\tflex-wrap: nowrap;\n\t\talign-content: stretch;\n\t\tjustify-content: space-evenly;\n\t\talign-items: stretch;\n\t}\n\t.flexitem {\n\t\tmargin: 1em;\n\t\tpadding: 1em;\n\t\tbackground-color: lightgray;\n\t}\n\t.item {\n\t\t/* \t\tflex: 1; */\n\t\tborder: 1px solid grey;\n\t\theight: 30px;\n\t\twidth: 50px;\n\t}\n\tul {\n\t\tpadding: 1em;\n\t}\n\n\t.menu {\n\t\tposition: absolute;\n\t\ttop: 10px;\n\t\tleft: 10px;\n\t\tmargin: 0.1em;\n\t\tpadding: 2em;\n\t\tz-index: 10;\n\t\tbackground-color: rgba(133, 198, 255, 0.801);\n\t}\n</style>\n"],"names":[],"mappings":"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"}